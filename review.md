# Code Review

- **Infinite pagination loop** (`src/fetchEvents.js`:324-334): The events pagination loop only checks the clipped/total flags and never stops when the page size drops below the limit or when the offset surpasses `total_count`. On the final page (or empty page), `events.length` can be `< 1000`, leaving the condition true and causing an infinite fetch. Break when `eventsResponse.data.events.length < limit` or when `offset >= total_count`.
- **ERC20 sanity check false positives** (`src/fetchEvents.js`:211-223): The ERC20 log check references `row.address`, but that field is never set. For contract addresses passed via `rel`, ERC20 logs where the address is neither `from` nor `to` will throw “Unexpected ERC20 transfer” even though the contract itself matches. Either set `row.address` from `ev.body.address` or drop that part of the sanity check.
- **Transactions pagination missing** (`src/fetchEvents.js`:338-364): Sapphire 2023 transaction backfill only pulls a single 1000-record page and throws if there are more, so busy accounts fail to export. Implement proper pagination (offset/limit loop) or return a clear “data truncated” warning instead of throwing.
